<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap 101 Template</title>

    <!-- Bootstrap -->
    <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
      <script src="lib/d3/d3.v3.min.js"></script>
    <!--  <script type='text/javascript' src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"> </script> -->

    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
      <script>
        var qsParm = new Array();
        function qs() {
          var query = window.location.search.substring(1);
          var parms = query.split('&');
          for (var i=0; i<parms.length; i++) {
          var pos = parms[i].indexOf('=');
          if (pos > 0) {
           var key = parms[i].substring(0,pos);
            var val = parms[i].substring(pos+1);
             qsParm[key] = val;
            }
           }
        }

    qsParm['domain'] = null;
    qs();
    </script>

<!--style settings for visualisation-->
<style>

.link {
  stroke: #ccc;
}

.node {
  stroke: #fff;
  stroke-width: 1.5px;
}

.node text {
  stroke: #000000;
  stroke-width: 0.5px;
  font: 12px helvetica;
}

d3-tip {
    line-height: 1;
    color: black;
}

</style>

  </head>
  <body>
  <center>


  <nav class="navbar navbar-default">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">NNB Data Visualisation</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <button type="button" class="btn btn-default navbar-btn">Show CodeLists</button>        
      </ul>
      <form class="navbar-form navbar-left" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search">
        </div>
        <button type="submit" class="btn btn-default">Submit</button>
      </form>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="#">Back to IMS</a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
  <div class="ui-widget">
   <input id="search">
    <button type="button" onclick="searchNode()">Search</button>
</div>

  <!--main visualisation script-->
    
    <script>
    var padding = 20;
    var border=1;
    var bordercolor='black';
    var width = 1300,
    height = 800
 

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

    //Set up tooltip
/*var tip = d3.tip()
    .attr('class', 'd3-tip')
    .offset([-10, 0])
    .html(function (d) {
    return  d.name + "";
})*/
//svg.call(tip);


var force = d3.layout.force()
    .gravity(.05)
    .distance(100)
    .charge(-200)
    .size([width, height]);

d3.json("asset_data_model.json", function(error, json) {
  force
      .nodes(json.nodes)
     .links(json.links)
      .start();

  var toggle = 0;
//Create an array logging what is connected to what
var linkedByIndex = {};
for (i = 0; i < json.nodes.length; i++) {
    linkedByIndex[i + "," + i] = 1;
};
json.links.forEach(function (d) {
    linkedByIndex[d.source.index + "," + d.target.index] = 1;
});

  var link = svg.selectAll(".link")
      .data(json.links)
    .enter().append("line")
      .attr("class", "link"); 

  var node = svg.selectAll(".node")
      .data(json.nodes)
    .enter().append("g")
      .attr("class", "node")
      //.on("mouseover",mouseover)
      //.on("mouseout",mouseout)
    // .on("mousedown",mousedown)
     // .on("mouseup",mouseup)
      .call(force.drag)
      .on('dblclick', connectedNodes)
     // .on('mouseover', tip.show) //Added
     // .on('mouseout', tip.hide); //Added 



     node.append("circle")
     .attr("r",function(d) {if (d.source === "yes") {return 15;} else {return 10;} })
     .style("fill", function(d) {
        var returncolour;
        if (d.source === "yes") { returncolour = "#A64B00"}
          else {returncolour = "#ff9640"}
            return returncolour;
     });

  node.append("svg:title")
    .text(function(d) {return d.name});

 var text =  node.append("text")
      .attr("dx", 18)
      .attr("dy", 0)
      .text(function(d) { return d.name });

       





      node.on("mousedown", function(d) { d.fixed = true });


 
  force.on("tick", function() {
    link.attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
  });


function mouseover() {
  d3.select(this).select("circle").transition()
      .duration(750)
      .attr("r", 16);
  //enableThumbPopover;

}

function mouseout() {
  d3.select(this).select("circle").transition()
      .duration(750)
      .attr("r", 8);
}


//This function looks up whether a pair are neighbours
function neighboring(a, b) {
    return linkedByIndex[a.index + "," + b.index];
}
function connectedNodes() {
    if (toggle == 0) {
        //Reduce the opacity of all but the neighbouring nodes
        d = d3.select(this).node().__data__;
        node.style("opacity", function (o) {
            return neighboring(d, o) | neighboring(o, d) ? 1 : 0.1;
        });
        link.style("opacity", function (o) {
            return d.index==o.source.index | d.index==o.target.index ? 1 : 0.1;
        });
        //Reduce the op
        toggle = 1;
    } else {
        //Put them back to opacity=1
        node.style("opacity", 1);
        link.style("opacity", 1);
        toggle = 0;
    }
}

});



    //document.write(qsParm['domain']);
    //document.write(document.referrer);
    </script>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    </center>
  </body>
</html>